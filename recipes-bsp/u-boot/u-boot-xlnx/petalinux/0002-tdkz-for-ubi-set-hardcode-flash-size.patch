From c588833abe9231c05acbfbec5d3fdbd52b13bbb9 Mon Sep 17 00:00:00 2001
From: Marc Brakels <marc.brakels@topic.nl>
Date: Fri, 5 Mar 2021 15:52:44 +0100
Subject: [PATCH 2/2] tdkz for ubi set hardcode flash size

---
 drivers/mtd/ubi/build.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/drivers/mtd/ubi/build.c b/drivers/mtd/ubi/build.c
index 42c5270c7f..90ea5fea04 100644
--- a/drivers/mtd/ubi/build.c
+++ b/drivers/mtd/ubi/build.c
@@ -672,10 +672,11 @@ static int io_init(struct ubi_device *ubi, int max_beb_per1024)
 	 * Note, in this implementation we support MTD devices with 0x7FFFFFFF
 	 * physical eraseblocks maximum.
 	 */
+	
 
-	ubi->peb_size   = ubi->mtd->erasesize;
-	ubi->peb_count  = mtd_div_by_eb(ubi->mtd->size, ubi->mtd);
-	ubi->flash_size = ubi->mtd->size;
+	ubi->peb_size = 65536;
+	ubi->peb_count  = 480;
+	ubi->flash_size = ubi->peb_count * ubi->peb_size;
 
 	if (mtd_can_have_bb(ubi->mtd)) {
 		ubi->bad_allowed = 1;
-- 
2.17.1

